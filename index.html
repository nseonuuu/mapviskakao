<!DOCTYPE html>
<html lang="ko">


<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RToday Checker</title>
    <link rel="stylesheet" href="styles.css">
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=a035643f71b9f10705041cf4f38eb95b&libraries=services,clusterer"></script>

  </head>

<body>
    <header>
        <h1>RToday Checker</h1>
    </header>
    <main>
        <div id="controls">
            <input id="pac-input" type="text" placeholder="위치 검색">
        </div>
        <div id="map"></div>
        <p>
    	    <button onclick="setCenter()">처음으로</button> 
	</p>
        <div id="dataframe-container"></div>
    </main>
    <footer>
        <p>&copy; Copyright 2017. cizipcommunity. All rights reserved.</p>
    </footer>

    <script>
      var container = document.getElementById('map'); //지도를 담을 영역의 DOM 레퍼런스
      var options = { //지도를 생성할 때 필요한 기본 옵션
	            center: new kakao.maps.LatLng(37.5642135, 127.0016985), //지도의 중심좌표.
	            level: 7 //지도의 레벨(확대, 축소 정도)

      };

      var map = new kakao.maps.Map(container, options); //지도 생성 및 객체 리턴

      // 지도에 교통정보를 표시하도록 지도타입을 추가합니다
      map.addOverlayMapTypeId(kakao.maps.MapTypeId.TRAFFIC);

      function setCenter() {           
	  // 이동할 위도 경도 위치를 생성합니다 
	  var moveLatLon = new kakao.maps.LatLng(37.5642135, 127.0016985);
    
          // 지도 중심을 이동 시킵니다
   	  map.setCenter(moveLatLon);
      }

        // CSV에서 데이터를 가져와 지도에 마커와 선을 그리는 함수
function displayMarkersAndLinesFromCSV() {
    Papa.parse('RT_SU_Update.csv', {
        download: true,
        header: true,
        complete: function(results) {
            results.data.forEach(function(row) {
                var areas = row['관련 지역'].split('/'); // '/'로 구분된 장소를 분리
                var prevLatLng = null;
                areas.forEach(function(area) {
                    // 장소의 좌표를 얻기
                    new kakao.maps.services.Geocoder().addressSearch(area, function(result, status) {
                        if (status === kakao.maps.services.Status.OK) {
                            var latLng = new kakao.maps.LatLng(result[0].y, result[0].x);
                            // 마커 추가
                            new kakao.maps.Marker({
                                map: map,
                                position: latLng
                            });
                            // 이전 장소와 현재 장소를 연결하는 선을 그리기
                            if (prevLatLng) {
                                new kakao.maps.Polyline({
                                    map: map,
                                    path: [prevLatLng, latLng]
                                });
                            }
                            prevLatLng = latLng;
                        }
                    });
                });
            });
        }
    });
}

// CSV 파일에서 데이터를 불러와 지도에 마커와 선을 그리기
displayMarkersAndLinesFromCSV();
    </script>

</body>

</html>
